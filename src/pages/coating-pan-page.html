<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../elements/text-input.html">
<link rel="import" href="../elements/number-unit-input.html">
<link rel="import" href="../elements/coating-pan-graphic.html">
<link rel="import" href="../redux-mixin.html">
<link rel="import" href="../my-icons.html">
<link rel="import" href="shared-page-styles.html">

<dom-module id="coating-pan-page">
  <template>
    <style include='shared-page-styles'>
      .graphic-container {
        display: flex;
        justify-content: space-around;
      }
      .pan-graphic {
        height: 256px;
        width: 256px;
        fill: var(--text-secondary-color);
        fill-opacity: 0.4;
        stroke: var(--text-primary-color);
        stroke-width: 0.25px;
        stroke-linejoin: round;
      }
      .pan-fill {
        fill: var(--app-primary-color);
      }
    </style>
    
    <firebase-auth id="auth" user="{{user}}"></firebase-auth>
    <firebase-query id='panQuery' path='/pans/[[user.uid]]'></firebase-query>
    
    <div id='header-container'>
      <div id='header-card'>
        <div id='header-subhead'>Equipment</div>
        <div id='header-title'>Coating Pan</div>
        <div id='header-text'>
          The coating pan dashboard provies insight into the coating pan you are using. 
        	With a few measurements of the coating pan you can learn more about different pan volumes, pan fill and pan speeds.
        	Or you can choose a coating pan from the library.
        </div>
      </div>
    </div>
    
    <div class='warning-chip' hidden='[[!isOverFilled]]'>
      <iron-icon icon='my-icons:warning'></iron-icon>
      <div class='warning-text'>
        Batch Volume exceed maximum working volume. Considering lower batch size or choosing a bigger coating pan.
      </div>
    </div>
    <div class='warning-chip' hidden='[[!isUnderFilled]]'>
      <iron-icon icon='my-icons:warning'></iron-icon>
      <div class='warning-text'>
        Batch Volume is below the recommended minimum working volume. Considering a higher batch size or choosing a bigger coating pan.
      </div>
    </div>
    
    <div id='main-container'>
      
      <div id='left-column'>
        
        <div class='card'>
          <div class='card-title'>Coating Pan Outline</div>
          <div class='graphic-container'>
            
            <coating-pan-graphic
              front-view
              pan-diameter='[[panDiameter]]'
              opening-diameter='[[openingDiameter]]'
              wall-width='[[wallWidth]]'
              brim-width='[[brimWidth]]'
              fill-height='[[fillHeight]]'
              fill-width='[[fillWidth]]'
              fill-length='[[fillLength]]'>
            </coating-pan-graphic>
            
            <coating-pan-graphic
              side-view
              pan-diameter='[[panDiameter]]'
              opening-diameter='[[openingDiameter]]'
              wall-width='[[wallWidth]]'
              brim-width='[[brimWidth]]'
              fill-height='[[fillHeight]]'
              fill-width='[[fillWidth]]'
              fill-length='[[fillLength]]'>
            </coating-pan-graphic>
            
          </div>
        </div>
          
        <div class='card'>
          <div class='card-title'>Inputs</div>
          <number-unit-input 
    	    	title='Main Diameter' 
    	    	value='[[panDiameter]]' 
    	    	type='length'
    	    	selected-units='{{lengthUnits}}'
    	    	details='The main diameter of the coating pan'
    	    	on-value-changed='panDiameterChanged'>
    	    </number-unit-input>
    	    <number-unit-input 
    	    	title='Opening' 
    	    	value='[[openingDiameter]]' 
    	    	type='length'
    	    	details='The diameter of the pan opening'
    	    	selected-units='{{lengthUnits}}'
    	    	on-value-changed='openingDiameterChanged'>
    	    </number-unit-input>
    	    <number-unit-input 
    	    	title='Depth at Brim' 
    	    	value='[[brimWidth]]' 
    	    	type='length'
    	    	selected-units='{{lengthUnits}}'
    	    	details='The depth from the front brim to the back'
    	    	on-value-changed='brimWidthChanged'>
    	    </number-unit-input>
    	    <number-unit-input 
    	    	title='Wall Depth' 
    	    	value='[[wallWidth]]' 
    	    	type='length'
    	    	details='The depth of the coating pan along the perforated pan wall'
    	    	selected-units='{{lengthUnits}}'
    	    	on-value-changed='wallWidthChanged'>
    	    </number-unit-input>
        </div>
        
        <div class='card'>
            <div class='card-title'>Estimated Volumes</div>
            <number-unit-input
              title='Brim Volume'
              details='The capacity of the pan to the brim'
              no-input 
              decimals='1' 
              value='[[brimVolume]]' 
              type='volume' 
              selected-units='{{volumeUnits}}'>
            </number-unit-input>
            <number-unit-input
              title='Max Volume'
              details='The max working volume determined as filled upto 1" from the brim'
              no-input 
              decimals='1' 
              value='[[maxFillVolume]]' 
              type='volume' 
              selected-units='{{volumeUnits}}'>
            </number-unit-input>
            <number-unit-input
              title='Min Volume'
              details='The min working volume determined as 60% full of brim height'
              no-input 
              decimals='1' 
              value='[[minFillVolume]]' 
              type='volume' 
              selected-units='{{volumeUnits}}'>
            </number-unit-input>
          </div>
          
     <!--   <div class='card'>-->
     <!--     <div class='card-title'>Pan Fill Calculations</div>-->
					<!--<number-unit-input-->
					<!--  no-input-->
     <!-- 	  	title='Fill Height' -->
    	<!--		  value='[[fillHeight]]' -->
    	<!--		  type='length' -->
    	<!--		  selected-units='{{lengthUnits}}'-->
    	<!--		  details='The maximum bed height'>-->
    	<!--		</number-unit-input>-->
    	<!--		<number-unit-input-->
					<!--  no-input-->
     <!-- 	  	title='Fill to Brim' -->
    	<!--		  value='[[fillToBrim]]' -->
    	<!--		  type='length' -->
    	<!--		  selected-units='{{lengthUnits}}'-->
    	<!--		  details='The distance between the product bed and the brim opening'>-->
    	<!--		</number-unit-input>-->
    	<!--	<number-unit-input-->
					<!--  no-input-->
     <!-- 	  	title='Fill Width' -->
    	<!--		  value='[[fillWidth]]' -->
    	<!--		  type='length' -->
    	<!--		  selected-units='{{lengthUnits}}'-->
    	<!--		  details='The maximum width of the product bed on the surface'>-->
    	<!--		</number-unit-input>-->
     <!--   </div>-->
     
     <div class='highlight-card'>
		    <div class='card-title'>What's Next</div>
		    <div class='card-text'>With the coating pan picked out we can not determine the 
		    amount of tablets to coat. Next we will look at some the tablets batch and determine
		    the optimal fill for this coating pan.</div>
		    <paper-button class='highlight-button' on-tap='gotoNext'>
		      <div>Batch</div>
		      <iron-icon icon='my-icons:arrow-forward'></iron-icon>
		    </paper-button>
		  </div>
        
      </div>
      
      <div class='right-column'>
        <div class='highlight-card'>
          <div class='card-title'>Coating Pan Library</div>
          <div class='card-text'>The library includes a list of coating pans with predefined measurements. The library is based on coating pans found 
          at different Colocon sites and coating pan vendor specfications. Choose one today to get started.
          </div>
          <paper-button class='highlight-button'on-tap='gotoLibrary'>Library</paper-button>
        </div>
        
        <div class='card'>
          <div class='card-title'>Information</div>
          <text-input title='Vendor' value='[[vendorName]]' on-value-changed='vendorNameChanged'></text-input>
          <text-input title='Equipment' value='[[equipmentName]]' on-value-changed='equipmentNameChanged'></text-input>
          <text-input title='Nickname' value='[[nickname]]' on-value-changed='nicknameChanged'></text-input>
          <text-input title='Company' value='[[companyName]]' on-value-changed='companyNameChanged'></text-input>
          <text-input title='Location' value='[[locationName]]' on-value-changed='locationNameChanged'></text-input>
        </div>
        
        <div class='highlight-card'>
          <div class='card-title'>Save Custom Pan</div>
          <div class='card-text'>
            Looks like you are creating a custom coating pan. Save it to reference it again later.
          </div>
          <paper-button class='highlight-button'on-tap=''>Save</paper-button>
        </div>
        
      </div>
      
    </div>
  </template>

  <script>
    class CoatingPanPage extends CoatingDashboard.ReduxMixin(Polymer.Element) {
      
      static get is() { return 'coating-pan-page'; }
      
      static get properties() {
        return {
          // properties from redux mixin
          panDiameter: {
            type: Number,
            statePath: 'pan.panDiameter'
          },
          openingDiameter: {
            type: Number,
            statePath: 'pan.openingDiameter'
          },
          wallWidth: {
            type: Number,
            statePath: 'pan.wallWidth'
          },
          brimWidth: {
            type: Number,
            statePath: 'pan.brimWidth'
          },
          fillVolume: {
            type: Number,
            statePath: 'pan.fillVolume'
          },
          vendorName: {
            type: String,
            statePath: 'pan.vendorName'
          },
          equipmentName: {
            type: String,
            statePath: 'pan.equipmentName'
          },
          nickname: {
            type: String,
            statePath: 'pan.nickname'
          },
          companyName: {
            type: String,
            statePath: 'pan.companyName'
          },
          locationName: {
            type: String,
            statePath: 'pan.locationName'
          },
          brimVolume: {
            type: Number,
            statePath: 'pan.brimVolume'
          },
          minFillVolume: {
            type: Number,
            statePath: 'pan.minFillVolume'
          },
          maxFillVolume: {
            type: Number,
            statePath: 'pan.maxFillVolume'
          },
          fillWidth: {
            type: Number,
            statePath: 'pan.fillWidth'
          },
          fillToBrim: {
            type: Number,
            statePath: 'pan.fillToBrim'
          },
          fillHeight: {
            type: Number,
            statePath: 'pan.fillHeight'
          },
          fillLength: {
            type: Number,
            statePath: 'pan.fillLength'
          },
          maxFillHeight: {
            type: Number,
            statePath: 'pan.maxFillHeight'
          },
          minFillHeight: {
            type: Number,
            statePath: 'pan.minFillHeight'
          },
          brimHeight: {
            type: Number,
            statePath: 'pan.brimHeight'
          },
          sideWallSlope: {
            type: Number,
            statePath: 'pan.sideWallSlope'
          },
          isOverFilled: { type: Boolean, statePath: 'pan.isOverFilled' },
          isUnderFilled: { type: Boolean, statePath: 'pan.isUnderFilled' },
          user: {
            type: Object
          },
          lengthUnits: {
            type: String,
            value: 'in'
          },
          volumeUnits: {
            type: String,
            value: 'l'
          }
        };
      }
      
      // User input functions
      panDiameterChanged(e){
        this.dispatch({
          type: 'SET_PAN_DIAMETER',
          value: e.detail.value
        });
      }
      openingDiameterChanged(e){
        this.dispatch({
          type: 'SET_PAN_OPENING_DIAMETER',
          value: e.detail.value
        });
      }
      wallWidthChanged(e){
        this.dispatch({
          type: 'SET_PAN_WALL_WIDTH',
          value: e.detail.value
        });
      }
      brimWidthChanged(e){
        this.dispatch({
          type: 'SET_PAN_BRIM_WIDTH',
          value: e.detail.value
        });
      }
      vendorNameChanged(e){
        this.dispatch({
          type: 'SET_PAN_VENDOR_NAME',
          value: e.detail.value
        });
      }
      equipmentNameChanged(e){
        this.dispatch({
          type: 'SET_PAN_EQUIPMENT_NAME',
          value: e.detail.value
        });
      }
      nicknameChanged(e){
        this.dispatch({
          type: 'SET_PAN_NICKNAME',
          value: e.detail.value
        });
      }
      companyNameChanged(e){
        this.dispatch({
          type: 'SET_PAN_COMPANY_NAME',
          value: e.detail.value
        });
      }
      locationNameChanged(e){
        this.dispatch({
          type: 'SET_PAN_LOCATION_NAME',
          value: e.detail.value
        });
      }
      
      saveCoatingPan() {
        if(!this.user) {
          this.$.auth.signInAnonymously();
        }
        this.$.panQuery.ref.push({
          vendorName: this.vendorName,
          equipmentName: this.equipmentName,
          nickname: this.nickname,
          companyName: this.companyName,
          locationName: this.locationName,
          panDiameter: this.panDiameter,
          openingDiameter: this.openingDiameter,
          brimWidth: this.brimWidth,
          wallWidth: this.wallWidth,
          calculatedBrimVolume: this.brimVolume,
          calculatedMaxFillVolume: this.maxFillVolume,
          calculatedMinFillVolume: this.minFillVolume
          
        });
      }
      gotoLibrary() {
        if(!this.user) {
          this.$.auth.signInAnonymously();
        }
        window.location = '#/coating-pan-library';
      }
      gotoNext() {
        window.location = '#/batch';
      }
      
    }

    window.customElements.define(CoatingPanPage.is, CoatingPanPage);
  </script>
</dom-module>
